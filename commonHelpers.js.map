{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\nconst formSearch = document.querySelector('.form');\nconst listGallery = document.querySelector('.gallery');\nconst span = document.querySelector('span');\nconst loadMoreBtn = document.querySelector('button[data-action=\"load-more\"]');\n\nconst instance = axios.create({\n    baseURL: 'https://pixabay.com/api/',\n    params: {\n        key: '41516646-ec27055f09ddd37d9bfda39a5',\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: 'true',\n        per_page: 40,\n    },\n});\n\nfunction errorMessage(error) {\n    iziToast.error({\n        message: `❌ Sorry, ${error}`,\n        icon: '',\n        position: 'topRight',\n    });\n}\n\nfunction classListRemove(element) {\n    element.classList.remove('visibility');\n}\n\nfunction classListAdd(element) {\n    element.classList.add('visibility');\n}\n\nconst getImage = async params => {\n    try {\n        const response = await instance.get('', { params });\n\n        return response.data;\n    } catch (error) {\n        classListAdd(span);\n\n        errorMessage(error);\n    }\n};\n\nconst createGetImage = q => {\n    let page = 1;\n    let isLastPage = false;\n    const perPage = 40;\n\n    return async () => {\n        try {\n            if (isLastPage) return [];\n\n            const { hits, totalHits } = await getImage({ page, q });\n\n            classListRemove(loadMoreBtn);\n\n            if (\n                page >= Math.ceil(totalHits / perPage) &&\n                Math.ceil(totalHits / perPage) !== 0\n            ) {\n                isLastPage = true;\n                classListAdd(loadMoreBtn);\n\n                iziToast.info({\n                    message:\n                        \"We're sorry, but you've reached the end of search results.\",\n                    position: 'topRight',\n                });\n            }\n\n            page += 1;\n\n            return hits;\n        } catch (error) {\n            classListAdd(span);\n            classListAdd(loadMoreBtn);\n\n            errorMessage(error);\n        }\n    };\n};\n\nlet doFetch = null;\n\nformSearch.addEventListener('submit', async event => {\n    event.preventDefault();\n\n    let clickOnLoad = false;\n\n    if (doFetch != null) {\n        loadMoreBtn.removeEventListener('click', doFetch);\n        doFetch = null;\n    }\n\n    const data = new FormData(event.currentTarget);\n    const search = data.get('search');\n\n    const fetchImage = createGetImage(search);\n\n    listGallery.innerHTML = '';\n\n    doFetch = async () => {\n        classListAdd(loadMoreBtn);\n        classListRemove(span);\n\n        const hits = await formMarkupCreating(fetchImage());\n\n        if (clickOnLoad) {\n            const scrollToNextGroup = () => {\n                const firstGalleryItem =\n                    document.querySelector('.gallery-item');\n\n                const galleryItemHeight =\n                    firstGalleryItem.getBoundingClientRect().height;\n\n                window.scrollBy({\n                    top: galleryItemHeight * 2,\n                    behavior: 'smooth',\n                });\n            };\n            loadMoreBtn.addEventListener('click', scrollToNextGroup());\n        }\n\n        clickOnLoad = true;\n\n        classListAdd(span);\n\n        return clickOnLoad;\n    };\n\n    await doFetch();\n\n    loadMoreBtn.addEventListener('click', doFetch);\n});\n\nasync function formMarkupCreating(result) {\n    try {\n        const dataFormImage = await result;\n        classListRemove(span);\n\n        if (!dataFormImage.length) {\n            iziToast.error({\n                message: `❌ Sorry, there are no images matching your search query. Please, try again!`,\n                icon: '',\n                position: 'topRight',\n            });\n\n            classListAdd(span);\n            classListAdd(loadMoreBtn);\n            return;\n        }\n        const gallery = new SimpleLightbox('.gallery a', {\n            captionsData: 'alt',\n            captionDelay: 250,\n            captionPosition: 'bottom',\n        });\n\n        const galleryMarkup = renderElement(dataFormImage);\n\n        listGallery.insertAdjacentHTML('beforeend', galleryMarkup);\n\n        gallery.refresh();\n    } catch (error) {\n        classListAdd(span);\n        classListAdd(loadMoreBtn);\n\n        errorMessage(error);\n    }\n}\n\nfunction renderElement(params) {\n    const render = params.reduce(\n        (\n            html,\n            {\n                webformatURL,\n                largeImageURL,\n                tags,\n                likes,\n                views,\n                comments,\n                downloads,\n            }\n        ) =>\n            html +\n            `<li class=\"gallery-item\">\n    <a class=\"gallery-link\" href=\"${largeImageURL}\">\n        <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\"/>\n    </a>\n    <ul class=\"characteristics-list\">\n    <li class=\"characteristics\"><span class=\"characteristics-titel\">Likes</span> <span>${likes}</span></li>\n    <li class=\"characteristics\"><span class=\"characteristics-titel\">Views</span> <span>${views}</span></li>\n    <li class=\"characteristics\"><span class=\"characteristics-titel\">Comments</span> <span>${comments}</span></li>\n    <li class=\"characteristics\"><span class=\"characteristics-titel\">Downloads</span> <span>${downloads}</span></li>\n</ul>\n    \n</li>`,\n        ''\n    );\n    return render;\n}\n"],"names":["formSearch","listGallery","span","loadMoreBtn","instance","axios","errorMessage","error","iziToast","classListRemove","element","classListAdd","getImage","params","createGetImage","q","page","isLastPage","perPage","hits","totalHits","doFetch","event","clickOnLoad","search","fetchImage","formMarkupCreating","scrollToNextGroup","galleryItemHeight","result","dataFormImage","gallery","SimpleLightbox","galleryMarkup","renderElement","html","webformatURL","largeImageURL","tags","likes","views","comments","downloads"],"mappings":"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"}